{% load static %}
<div class="col">
  <div class="catalog-item-card glass-card-simple">
    <!-- Hide Item Button -->
    {% if user.is_authenticated %}
    <button class="hide-item-btn" data-item-id="{{ item.pk }}" title="Hide this item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
        <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.244-.517.486z"/>
        <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/>
        <path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/>
      </svg>
    </button>
    {% endif %}

    <!-- Item Image -->
    <a href="{{ item.get_absolute_url }}" class="catalog-item-image-link">
      <div class="catalog-item-image">
        <img src="{{ item.image_url }}" alt="{{ item.title }}">
      </div>
    </a>
    
    <!-- Item Details -->
    <div class="catalog-item-body p-3">
      <!-- Category Badge -->
      <span class="simple-badge mb-2">{{ item.get_tag_display }}</span>
      
      <!-- Title (fixed height) -->
      <h5 class="text-white mb-2 catalog-item-title">
        <a href="{{ item.get_absolute_url }}" class="text-white text-decoration-none">
          {{ item.title|truncatewords:8 }}
        </a>
      </h5>
      
      <!-- Description (fixed height) -->
      <p class="text-white-50 small mb-3 catalog-item-description">{{ item.description|truncatewords:10 }}</p>
      
      <!-- Spacer to push buttons to bottom -->
      <div class="flex-grow-1"></div>
      
      <!-- Action Buttons -->
      <div class="catalog-item-actions">
        <a href="{{ item.get_absolute_url }}" class="btn-catalog-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye me-1" viewBox="0 0 16 16">
            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
          </svg>
          View Details
        </a>

        {% if user.is_authenticated %}
        <!-- Save to wardrobe form -->
        <form class="save-to-wardrobe-form" data-item-id="{{ item.pk }}">
          {% csrf_token %}
          <button type="submit" class="btn-catalog-primary w-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-bag-plus me-1" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5"/>
              <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
            </svg>
            <span class="btn-text">Save to Wardrobe</span>
          </button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  /* Catalog Item Card - FIXED HEIGHT */
  .catalog-item-card {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    min-height: 480px; /* Fixed minimum height for all cards */
    display: flex;
    flex-direction: column;
  }

  .catalog-item-card:hover {
    border-color: rgba(205, 180, 255, 0.4);
    transform: translateY(-4px);
    box-shadow: 0 8px 32px rgba(109, 17, 227, 0.2);
  }

  /* Hide Button */
  .hide-item-btn {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: rgba(220, 53, 69, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(220, 53, 69, 0.3);
    border-radius: 8px;
    padding: 0.5rem;
    color: #fff;
    z-index: 10;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .hide-item-btn:hover {
    background: rgba(220, 53, 69, 0.9);
    border-color: rgba(220, 53, 69, 0.5);
    transform: scale(1.1);
  }

  /* Item Image - FIXED HEIGHT */
  .catalog-item-image-link {
    display: block;
    text-decoration: none;
    flex-shrink: 0; /* Prevent image from shrinking */
  }

  .catalog-item-image {
    width: 100%;
    height: 200px; /* Fixed height for all images */
    overflow: hidden;
    background: rgba(0, 0, 0, 0.2);
  }

  .catalog-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .catalog-item-card:hover .catalog-item-image img {
    transform: scale(1.05);
  }

  /* Item Body - FLEX LAYOUT */
  .catalog-item-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0; /* Important for flex */
  }

  /* Title - FIXED HEIGHT */
  .catalog-item-title {
    height: 2.5rem; /* Fixed height for 2 lines of text */
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    line-height: 1.25rem;
    margin-bottom: 0.5rem !important;
  }

  .catalog-item-title a {
    transition: color 0.2s ease;
  }

  .catalog-item-title a:hover {
    color: #CDB4FF !important;
  }

  /* Description - FIXED HEIGHT */
  .catalog-item-description {
    height: 3rem; /* Fixed height for 2-3 lines */
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    line-height: 1rem;
    margin-bottom: 1rem !important;
  }

  /* Badge */
  .simple-badge {
    background: rgba(205, 180, 255, 0.2);
    border: 1px solid rgba(205, 180, 255, 0.3);
    color: #CDB4FF;
    padding: 0.35rem 0.75rem;
    border-radius: 8px;
    font-size: 0.7rem;
    font-weight: 600;
    display: inline-block;
    flex-shrink: 0;
  }

  /* Actions Container - ANCHORED TO BOTTOM */
  .catalog-item-actions {
    margin-top: auto; /* Push to bottom */
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  /* Buttons - CONSISTENT HEIGHT */
  .btn-catalog-primary,
  .btn-catalog-secondary {
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    font-size: 0.8125rem;
    font-weight: 500;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    height: 38px; /* Fixed button height */
  }

  .btn-catalog-primary {
    background: rgba(109, 17, 227, 0.15);
    border: 1px solid rgba(109, 17, 227, 0.3);
    color: #CDB4FF;
  }

  .btn-catalog-primary:hover:not(:disabled) {
    background: rgba(109, 17, 227, 0.25);
    border-color: rgba(109, 17, 227, 0.5);
    color: #fff;
    transform: translateY(-1px);
  }

  .btn-catalog-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .btn-catalog-secondary {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
  }

  .btn-catalog-secondary:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.2);
    color: #fff;
    transform: translateY(-1px);
  }

  /* Success/Already Saved States */
  .btn-catalog-primary.success {
    background: rgba(40, 167, 69, 0.15);
    border-color: rgba(40, 167, 69, 0.3);
    color: #28a745;
  }

  .btn-catalog-primary.already-saved {
    background: rgba(108, 117, 125, 0.15);
    border-color: rgba(108, 117, 125, 0.3);
    color: #6c757d;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .catalog-item-card {
      min-height: 450px;
    }

    .catalog-item-image {
      height: 180px;
    }
  }

  @media (max-width: 576px) {
    .catalog-item-card {
      min-height: 420px;
    }

    .catalog-item-image {
      height: 160px;
    }
  }
</style>