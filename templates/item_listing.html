{% extends "main.html" %}
{% load static %}
{% block title %}Item Catalog · Best Dressed{% endblock %}

{% block content %}
<div class="clean-glass-catalog">
  <div class="container py-5">
    
    <!-- Header -->
    <div class="text-center mb-5">
      <div class="sparkle-accent mb-3">
        <span class="sparkle-icon">✦</span>
      </div>
      <h1 class="display-5 fw-bold text-white mb-2">Find Your Style</h1>
      <p class="text-white-50 mb-0">Browse our curated collection of fashion items</p>
    </div>

    <!-- Search & Actions Bar -->
    <div class="glass-card-simple p-4 mb-4" style="position: relative; z-index: 100;">
      <form method="get" action="{% url 'item_listing' %}">
        <div class="row g-3">
          <!-- Search Column -->
          <div class="col-md-8">
            <label for="searchInput" class="form-label small text-white-50 mb-2">Search Items</label>
            <div class="glass-input-group">
              <span class="glass-input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                </svg>
              </span>
              <input 
                type="text" 
                name="q"
                id="searchInput"
                class="glass-input" 
                placeholder="Search by title or description..." 
                value="{% if query %}{{ query }}{% endif %}"
                aria-label="Search items">
            </div>
          </div>
          
          <!-- Actions Column -->
          <div class="col-md-4">
            <label class="form-label small text-white-50 mb-2 d-block">Actions</label>
            <div class="dropdown">
              <button class="btn-clean-glass dropdown-toggle w-100" type="button" id="addItemDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg me-1" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
                </svg>
                Add Item
              </button>
              <ul class="dropdown-menu glass-dropdown" aria-labelledby="addItemDropdown">
                <li>
                  <a class="dropdown-item" href="{% url 'add_item' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-pencil me-2" viewBox="0 0 16 16">
                      <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
                    </svg>
                    Add Manually
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{% url 'ebay_get_items' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-search me-2" viewBox="0 0 16 16">
                      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                    </svg>
                    Search eBay
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </form>
      
      <!-- Search Results Info -->
      {% if query %}
      <div class="mt-3">
        <small class="text-white-50">
          Showing results for "<strong class="text-white">{{ query }}</strong>"
        </small>
      </div>
      {% endif %}
    </div>

    <!-- Items Grid -->
    {% if items %}
    <div class="catalog-grid">
      {% for item in items %}
      {% include "item_card.html" with item=item %}
      {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="glass-card-simple p-5 text-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-inbox text-white-50 mb-3 opacity-50" viewBox="0 0 16 16">
        <path d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4zm9.954 5H10.45a2.5 2.5 0 0 1-4.9 0H1.066l.32 2.562a.5.5 0 0 0 .497.438h12.234a.5.5 0 0 0 .496-.438zM3.809 3.563A1.5 1.5 0 0 1 4.981 3h6.038a1.5 1.5 0 0 1 1.172.563l3.7 4.625a.5.5 0 0 1 .105.374l-.39 3.124A1.5 1.5 0 0 1 14.117 13H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .106-.374z"/>
      </svg>
      <h4 class="text-white mb-2">
        {% if query %}
          No items found for "{{ query }}"
        {% else %}
          No items in the catalog yet
        {% endif %}
      </h4>
      <p class="text-white-50 mb-4">
        {% if query %}
          Try a different search term
        {% else %}
          Start adding items to build your collection
        {% endif %}
      </p>
      {% if query %}
        <a href="{% url 'item_listing' %}" class="btn-clean-glass">View All Items</a>
      {% else %}
        <a href="{% url 'add_item' %}" class="btn-clean-glass">Add Your First Item</a>
      {% endif %}
    </div>
    {% endif %}

  </div>
</div>

<style>
  /* Base */
  .clean-glass-catalog {
    min-height: 100vh;
    background: linear-gradient(180deg, 
      rgba(109, 17, 227, 0.05) 0%, 
      rgba(0, 0, 0, 0) 100%);
  }

  .text-white-50 {
    color: rgba(255, 255, 255, 0.5) !important;
  }

  /* Sparkle Accent */
  .sparkle-accent {
    animation: sparkle 2s ease-in-out infinite;
  }

  .sparkle-icon {
    font-size: 2rem;
    color: #CDB4FF;
    display: inline-block;
  }

  @keyframes sparkle {
    0%, 100% { opacity: 0.6; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.1); }
  }

  /* Glass Cards */
  .glass-card-simple {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    transition: all 0.3s ease;
  }

  /* Form Labels - Consistent Spacing */
  .form-label {
    margin-bottom: 0.5rem;
  }

  /* Glass Inputs */
  .glass-input-group {
    position: relative;
    display: flex;
    align-items: center;
  }

  .glass-input-icon {
    position: absolute;
    left: 1rem;
    color: rgba(255, 255, 255, 0.5);
    z-index: 2;
    pointer-events: none;
  }

  .glass-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0.65rem 1rem 0.65rem 2.75rem;
    color: #fff;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    height: 42px;
  }

  .glass-input::placeholder {
    color: rgba(255, 255, 255, 0.3);
  }

  .glass-input:focus {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(205, 180, 255, 0.4);
    outline: none;
    box-shadow: 0 0 0 3px rgba(205, 180, 255, 0.1);
  }

  /* Dropdown - CRITICAL FIX FOR Z-INDEX */
  .dropdown {
    position: relative;
  }

  .dropdown-menu {
    z-index: 1050 !important;
  }

  .glass-dropdown {
    background: rgba(26, 26, 26, 0.98) !important;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    border-radius: 10px;
    padding: 0.5rem 0;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5) !important;
    min-width: 200px;
  }

  .glass-dropdown .dropdown-item {
    color: rgba(255, 255, 255, 0.8);
    padding: 0.5rem 1rem;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
  }

  .glass-dropdown .dropdown-item:hover {
    background: rgba(205, 180, 255, 0.15);
    color: #fff;
  }

  .glass-dropdown .dropdown-item:active {
    background: rgba(205, 180, 255, 0.25);
  }

  /* Buttons */
  .btn-clean-glass {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #fff;
    padding: 0.65rem 1.25rem;
    border-radius: 10px;
    font-weight: 500;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 42px;
  }

  .btn-clean-glass:hover {
    background: rgba(205, 180, 255, 0.2);
    border-color: rgba(205, 180, 255, 0.4);
    color: #fff;
    transform: translateY(-2px);
  }

  /* CRITICAL: Force equal heights for catalog grid */
  .catalog-grid {
    display: grid !important;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
  }

  @media (min-width: 576px) {
    .catalog-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 768px) {
    .catalog-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 992px) {
    .catalog-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1200px) {
    .catalog-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Ensure .col takes full height in grid */
  .catalog-grid > .col {
    height: 100%;
    min-height: 480px;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .row.g-3 {
      row-gap: 1rem !important;
    }
    
    .catalog-grid > .col {
      min-height: 450px;
    }
  }

  @media (max-width: 576px) {
    .sparkle-icon {
      font-size: 1.5rem;
    }

    .display-5 {
      font-size: 2rem;
    }
    
    .catalog-grid > .col {
      min-height: 420px;
    }
  }
</style>

{% include "item_card_logic.html" %}
{% endblock %}